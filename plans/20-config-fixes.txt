 Plan: Fix Config Module Integration Issues                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ After analyzing the codebase, I understand the issues. The new optimized config module uses static CONFIG (LazyLock) but the code is still trying to use old methods that don't exist. Here's what needs to be fixed:               │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ Issues Found:                                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ 1. Missing Methods (Main Issue)                                                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ - GuardyConfig::load() - 11 usage sites                                                                                                                                                                                             │ │
│ │ - config.get_section() - 5 usage sites                                                                                                                                                                                              │ │
│ │ - These methods don't exist because we now use static CONFIG.section access                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ 2. Serde Issues                                                                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ - Arc<Vec<String>> fields don't implement Deserialize                                                                                                                                                                               │ │
│ │ - Need custom serde handling or wrapper types                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ 3. Type Mismatches                                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ - config.max_threads is usize but function expects u16                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ Fix Strategy:                                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ Phase 1: Replace old method calls                                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ - Replace GuardyConfig::load(...) with CONFIG.clone() or direct field access                                                                                                                                                        │ │
│ │ - Replace config.get_section("hooks") with CONFIG.hooks.clone()                                                                                                                                                                     │ │
│ │ - Replace config.get_section("sync") with CONFIG.sync.clone()                                                                                                                                                                       │ │
│ │ - For config CLI commands that need export/get functionality, use CONFIG + export methods                                                                                                                                           │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ Phase 2: Fix Serde Issues                                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ - Add #[serde(with = "arc_vec_serde")] to Arc<Vec> fields                                                                                                                                                                           │ │
│ │ - Create custom serde module for Arc<Vec> serialization                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ Phase 3: Fix Type Issues                                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ - Cast max_threads from u16 to usize in profiling.rs                                                                                                                                                                                │ │
│ │ - Update any other type mismatches                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ Phase 4: Update Tests                                                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ - Fix test files that use old load() method                                                                                                                                                                                         │ │
│ │ - Use CONFIG or test-specific config instances                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ Files to Modify:                                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ - src/config/core.rs - Add serde helpers                                                                                                                                                                                            │ │
│ │ - src/cli/commands/config.rs - Replace load() calls                                                                                                                                                                                 │ │
│ │ - src/cli/commands/run.rs - Replace load() calls                                                                                                                                                                                    │ │
│ │ - src/cli/commands/install.rs - Replace load() calls                                                                                                                                                                                │ │
│ │ - src/cli/commands/status.rs - Replace load() calls                                                                                                                                                                                 │ │
│ │ - src/cli/commands/sync.rs - Replace load() calls                                                                                                                                                                                   │ │
│ │ - src/hooks/executor.rs - Replace get_section() calls                                                                                                                                                                               │ │
│ │ - src/sync/manager.rs - Replace get_section() calls                                                                                                                                                                                 │ │
│ │ - src/profiling.rs - Fix type casting                                                                                                                                                                                               │ │
│ │ - src/config/formats.rs - Fix test methods                                                                                                                                                                                          │ │
│ │ - src/scan/types.rs - Remove unused import                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                                     │ │
│ │ This streamlined approach will make the config system much cleaner by using the static CONFIG everywhere instead of loading configs multiple times.  